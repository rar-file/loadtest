version: '3.8'

services:
  loadtest:
    build:
      context: .
      dockerfile: Dockerfile
    image: loadtest:latest
    container_name: loadtest
    volumes:
      - ./examples:/app/examples:ro
      - ./reports:/app/reports
    environment:
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
    # Override default command with your test file
    # command: ["run", "/app/examples/simple_http_load.py"]
    # Or with HTML report output
    # command: ["run", "/app/examples/simple_http_load.py", "--output", "/app/reports/report.html"]
    networks:
      - loadtest-network

  # Watchtower for auto-updating the image (optional)
  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_POLL_INTERVAL=3600
      - WATCHTOWER_CLEANUP=true
    profiles:
      - watchtower

networks:
  loadtest-network:
    driver: bridge
