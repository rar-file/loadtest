version: '3.8'

services:
  loadtest:
    build:
      context: .
      dockerfile: Dockerfile
    image: loadtest:latest
    container_name: loadtest
    volumes:
      - ./tests:/app/tests:ro
      - ./reports:/app/reports
      - ./examples:/app/examples:ro
    command: ["run", "/app/examples/simple_http_load.py"]
    environment:
      - PYTHONUNBUFFERED=1
    networks:
      - loadtest-network

  # Optional: LoadTest Master for distributed testing
  loadtest-master:
    build:
      context: .
      dockerfile: Dockerfile
    image: loadtest:latest
    container_name: loadtest-master
    ports:
      - "5557:5557"
    command: ["master", "--bind", "0.0.0.0:5557"]
    networks:
      - loadtest-network
    profiles:
      - distributed

  # Optional: LoadTest Worker for distributed testing
  loadtest-worker:
    build:
      context: .
      dockerfile: Dockerfile
    image: loadtest:latest
    depends_on:
      - loadtest-master
    command: ["worker", "--master", "loadtest-master:5557"]
    networks:
      - loadtest-network
    profiles:
      - distributed
    deploy:
      replicas: 2

networks:
  loadtest-network:
    driver: bridge
